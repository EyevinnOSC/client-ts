/**
 * This file was auto-generated by openapi-typescript.
 * Do not make direct changes to the file.
 */

export interface paths {
  '/': {
    /** Health check endpoint */
    get: {
      parameters: {
        query: {
          verbose?: boolean;
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: Partial<string> &
            Partial<{
              status: string;
              versions: {
                '@osaas/orchestrator': string;
              };
              environment: string;
              _links: {
                self: {
                  href: string;
                };
                api: {
                  href: string;
                };
              };
            }>;
        };
        /** Default Response */
        500: {
          schema: {
            status: string;
            reason: string;
          };
        };
      };
    };
  };
  '/n8ninstance': {
    /** List all running n8n instances */
    get: {
      responses: {
        /** Default Response */
        200: {
          schema: ({
            /** @description Name of the n8n instance */
            name: string;
            /** @description URL to instance API */
            url: string;
            resources: {
              license: {
                /** @description URL to license information */
                url: string;
              };
              apiDocs?: {
                /** @description URL to instance API documentation */
                url: string;
              };
              app?: {
                /** @description URL to instance application (GUI) */
                url: string;
              };
            };
            DatabaseUrl?: string;
            RunnersAuthToken: string;
          } & {
            _links: {
              self: {
                /** @description Instance resource */
                href: string;
              };
              logs?: {
                /** @description Get logs for this instance */
                href: string;
              };
              health?: {
                /** @description Get health status for this instance */
                href: string;
              };
              ports?: {
                /** @description Get exposed ports for this instance */
                href: string;
              };
              restart?: {
                /** @description Restart this instance */
                href: string;
              };
              update?: {
                /** @description Update this instance */
                href: string;
              };
              scale?: {
                /** @description Scale this instance */
                href: string;
              };
            };
          })[];
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
    /** Launch a new n8n instance */
    post: {
      parameters: {
        query: {
          beta?: boolean;
        };
        body: {
          body?: {
            /** @description Name of the n8n instance */
            name: string;
            DatabaseUrl?: string;
            RunnersAuthToken: string;
          };
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: {
            /** @description Name of the n8n instance */
            name: string;
            /** @description URL to instance API */
            url: string;
            resources: {
              license: {
                /** @description URL to license information */
                url: string;
              };
              apiDocs?: {
                /** @description URL to instance API documentation */
                url: string;
              };
              app?: {
                /** @description URL to instance application (GUI) */
                url: string;
              };
            };
            DatabaseUrl?: string;
            RunnersAuthToken: string;
          } & {
            _links: {
              self: {
                /** @description Instance resource */
                href: string;
              };
              logs?: {
                /** @description Get logs for this instance */
                href: string;
              };
              health?: {
                /** @description Get health status for this instance */
                href: string;
              };
              ports?: {
                /** @description Get exposed ports for this instance */
                href: string;
              };
              restart?: {
                /** @description Restart this instance */
                href: string;
              };
              update?: {
                /** @description Update this instance */
                href: string;
              };
              scale?: {
                /** @description Scale this instance */
                href: string;
              };
            };
          };
        };
        /** Default Response */
        403: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
        /** Default Response */
        409: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
  };
  '/restart/{id}': {
    /** Restart n8n */
    post: {
      parameters: {
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        204: {
          schema: string;
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
  };
  '/n8ninstance/{id}': {
    /** Obtain status and resource URLs for an n8n instance */
    get: {
      parameters: {
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: {
            /** @description Name of the n8n instance */
            name: string;
            /** @description URL to instance API */
            url: string;
            resources: {
              license: {
                /** @description URL to license information */
                url: string;
              };
              apiDocs?: {
                /** @description URL to instance API documentation */
                url: string;
              };
              app?: {
                /** @description URL to instance application (GUI) */
                url: string;
              };
            };
            DatabaseUrl?: string;
            RunnersAuthToken: string;
          } & {
            _links: {
              self: {
                /** @description Instance resource */
                href: string;
              };
              logs?: {
                /** @description Get logs for this instance */
                href: string;
              };
              health?: {
                /** @description Get health status for this instance */
                href: string;
              };
              ports?: {
                /** @description Get exposed ports for this instance */
                href: string;
              };
              restart?: {
                /** @description Restart this instance */
                href: string;
              };
              update?: {
                /** @description Update this instance */
                href: string;
              };
              scale?: {
                /** @description Scale this instance */
                href: string;
              };
            };
          };
        };
        /** Default Response */
        404: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
    /** Stop and remove an n8n instance */
    delete: {
      parameters: {
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        204: {
          schema: string;
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
    /** Patch n8n instance with new parameters and restart */
    patch: {
      parameters: {
        body: {
          body?: {
            /** @description Name of the n8n instance */
            name?: string;
            DatabaseUrl?: string;
            RunnersAuthToken?: string;
          };
        };
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: {
            /** @description Name of the n8n instance */
            name: string;
            /** @description URL to instance API */
            url: string;
            resources: {
              license: {
                /** @description URL to license information */
                url: string;
              };
              apiDocs?: {
                /** @description URL to instance API documentation */
                url: string;
              };
              app?: {
                /** @description URL to instance application (GUI) */
                url: string;
              };
            };
            DatabaseUrl?: string;
            RunnersAuthToken: string;
          } & {
            _links: {
              self: {
                /** @description Instance resource */
                href: string;
              };
              logs?: {
                /** @description Get logs for this instance */
                href: string;
              };
              health?: {
                /** @description Get health status for this instance */
                href: string;
              };
              ports?: {
                /** @description Get exposed ports for this instance */
                href: string;
              };
              restart?: {
                /** @description Restart this instance */
                href: string;
              };
              update?: {
                /** @description Update this instance */
                href: string;
              };
              scale?: {
                /** @description Scale this instance */
                href: string;
              };
            };
          };
        };
        /** Default Response */
        400: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
        /** Default Response */
        404: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
  };
  '/health/{id}': {
    /** Return status of n8n instance */
    get: {
      parameters: {
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: {
            /** @enum {string} */
            status: 'starting' | 'running' | 'stopped' | 'failed' | 'unknown';
            images?: string[];
          };
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
  };
  '/logs/{id}': {
    /** Return the latest logs from the n8n instance */
    get: {
      parameters: {
        query: {
          timestamps?: boolean;
          sinceSeconds?: number;
        };
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: string;
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
  };
  '/ports/{id}': {
    /** Return the exposed extra ports for n8n instance */
    get: {
      parameters: {
        path: {
          /** Name of the n8n instance */
          id: string;
        };
      };
      responses: {
        /** Default Response */
        200: {
          schema: {
            externalIp: string;
            externalPort: number;
            internalPort: number;
          }[];
        };
        /** Default Response */
        500: {
          schema: {
            /** @description Reason why something failed */
            reason: string;
          };
        };
      };
    };
  };
}

export interface definitions {}

export interface operations {}

export interface external {}

export type N8nIoN8n =
  paths['/n8ninstance/{id}']['get']['responses']['200']['schema'];

export type N8nIoN8nConfig =
  paths['/n8ninstance']['post']['parameters']['body']['body'];
import {
  Context,
  createInstance,
  waitForInstanceReady,
  removeInstance,
  getInstance
} from '@osaas/client-core';
/**
 * @namespace n8n-io-n8n
 * @description Supercharge your team's productivity with n8n, the ultimate workflow automation platform. Enjoy seamless integration with 400+ apps, built-in AI, and full control over your data. Flexibility meets efficiency.
 * @author Eyevinn Technology AB <osc@eyevinn.se>
 * @copyright 2026 Eyevinn Technology AB
 *
 */

/**
 * @typedef {Object} N8nIoN8nConfig
 * @property {string} name - Name of n8n
 * @property {string} [DatabaseUrl] - Connection string URL for the database that n8n uses to store workflow data, execution history, credentials, and other persistent information. This is essential for production deployments where data needs to be preserved across restarts.
 * @property {string} RunnersAuthToken - Authentication token used to secure communication between n8n main process and task runners. Required for isolating and executing code in separate processes for enhanced security.

 * 
 */

/**
 * @typedef {Object} N8nIoN8n
 * @property {string} name - Name of the n8n instance
 * @property {string} url - URL of the n8n instance
 *
 */

/**
 * Create a new n8n instance
 *
 * @memberOf n8n-io-n8n
 * @async
 * @param {Context} context - Open Source Cloud configuration context
 * @param {N8nIoN8nConfig} body - Service instance configuration
 * @returns {N8nIoN8n} - Service instance
 * @example
 * import { Context } from '@osaas/client-core';
 * import { createN8nIoN8nInstance } from '@osaas/client-services';
 *
 * const ctx = new Context();
 * const body: N8nIoN8nConfig = { name: 'myinstance', ... };
 * const instance = await createN8nIoN8nInstance(ctx, body);
 * console.log(instance.url);
 */
export async function createN8nIoN8nInstance(
  ctx: Context,
  body: N8nIoN8nConfig
): Promise<N8nIoN8n> {
  const serviceAccessToken = await ctx.getServiceAccessToken('n8n-io-n8n');
  const instance = await createInstance(
    ctx,
    'n8n-io-n8n',
    serviceAccessToken,
    body
  );
  await waitForInstanceReady('n8n-io-n8n', instance.name, ctx);
  return instance;
}

/**
 * Remove a n8n instance
 *
 * @memberOf n8n-io-n8n
 * @async
 * @param {Context} context - Open Source Cloud configuration context
 * @param {string} name - Name of the n8n to be removed
 */
export async function removeN8nIoN8nInstance(
  ctx: Context,
  name: string
): Promise<void> {
  const serviceAccessToken = await ctx.getServiceAccessToken('n8n-io-n8n');
  await removeInstance(ctx, 'n8n-io-n8n', name, serviceAccessToken);
}

/**
 * Get a n8n instance
 *
 * @memberOf n8n-io-n8n
 * @async
 * @param {Context} context - Open Source Cloud configuration context
 * @param {string} name - Name of the n8n to be retrieved
 * @returns {N8nIoN8n} - Service instance
 * @example
 * import { Context } from '@osaas/client-core';
 * import { getN8nIoN8nInstance } from '@osaas/client-services';
 *
 * const ctx = new Context();
 * const instance = await getN8nIoN8nInstance(ctx, 'myinstance');
 * console.log(instance.url);
 */
export async function getN8nIoN8nInstance(
  ctx: Context,
  name: string
): Promise<N8nIoN8n> {
  const serviceAccessToken = await ctx.getServiceAccessToken('n8n-io-n8n');
  return await getInstance(ctx, 'n8n-io-n8n', name, serviceAccessToken);
}
